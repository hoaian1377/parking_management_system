<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quản lý nhân viên</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100">

<!-- Navbar -->
<nav class="fixed top-0 left-0 right-0 bg-blue-600 text-white shadow z-50">
  <div class="container mx-auto flex justify-between items-center px-4 py-3">
    <a href="{% url 'home' %}" class="font-bold text-lg">Quản lý Nhân viên</a>
    <div class="hidden md:flex space-x-6 items-center">
      <a href="{% url 'vehicle_management' %}" class="hover:text-gray-200">Quản lý xe</a>
      <a href="{% url 'parking_status' %}" class="hover:text-gray-200">Tình trạng bãi xe</a>
      <a href="{% url 'vehicle_report' %}" class="hover:text-gray-200">Báo cáo & thống kê</a>
      <a href="{% url 'login' %}" class="bg-white text-blue-600 px-3 py-1 rounded hover:bg-gray-100">Đăng xuất</a>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container mx-auto pt-24 px-4">

  <h2 class="text-3xl font-bold mb-6">Quản lý nhân viên</h2>

  <!-- Flash Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="p-4 mb-4 rounded {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- Search Form -->
  <form method="get" action="{% url 'search_employee' %}" class="flex flex-wrap gap-3 mb-6">
    <input type="text" name="nhanvienid" placeholder="Nhập mã nhân viên" class="flex-1 p-3 border rounded focus:ring-2 focus:ring-blue-500" required>
    <button type="submit" class="px-5 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Tìm kiếm</button>
  </form>

  <!-- Add Employee Button -->
  <button id="show_add_employee_form" class="mb-6 px-5 py-3 bg-green-600 text-white rounded hover:bg-green-700 transition">
    Thêm Nhân Viên
  </button>

  <!-- Employee Table -->
  <div class="overflow-x-auto">
    <table class="w-full table-auto bg-white rounded-lg shadow-md">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="p-3">Mã NV</th>
          <th class="p-3">Tên NV</th>
          <th class="p-3">Chức vụ</th>
          <th class="p-3">Địa chỉ</th>
          <th class="p-3">Số ĐT</th>
          <th class="p-3">Ngày sinh</th>
          <th class="p-3">Email</th>
          <th class="p-3">Mật khẩu</th>
          <th class="p-3">Phân quyền</th>
          <th class="p-3">Hành động</th>
        </tr>
      </thead>
      <tbody>
        {% for nhanvien in nhanviens %}
        <tr class="border-b hover:bg-gray-100">
          <td class="p-3">{{ nhanvien.nhanvienid }}</td>
          <td class="p-3">{{ nhanvien.hoten }}</td>
          <td class="p-3">{{ nhanvien.chucvu }}</td>
          <td class="p-3">{{ nhanvien.diachi }}</td>
          <td class="p-3">{{ nhanvien.sodienthoai }}</td>
          <td class="p-3">{{ nhanvien.ngaysinh }}</td>
          <td class="p-3">{{ nhanvien.email }}</td>
          <td class="p-3">{{ nhanvien.matkhau }}</td>
          <td class="p-3">
            <span class="px-2 py-1 rounded-full text-sm {% if nhanvien.phanquyen == 'Quản lý' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
              {{ nhanvien.phanquyen }}
            </span>
          </td>
          <td class="p-3 flex gap-2">
            <button class="edit-btn bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm" data-id="{{ nhanvien.nhanvienid }}">Sửa</button>
            <form method="POST" action="{% url 'delete_employee' nhanvien.nhanvienid %}" onsubmit="return confirm('Bạn có chắc muốn xóa nhân viên này?')">
              {% csrf_token %}
              <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Xóa</button>
            </form>
          </td>
        </tr>

        <!-- Edit Form Row -->
        <tr id="edit-form-{{ nhanvien.nhanvienid }}" class="hidden bg-gray-50">
          <td colspan="10" class="p-4">
            <form method="POST" action="{% url 'edit_employee' nhanvien.nhanvienid %}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              {% csrf_token %}
              <input type="text" name="hoten" value="{{ nhanvien.hoten }}" placeholder="Tên nhân viên" class="p-2 border rounded" required>
              <input type="text" name="chucvu" value="{{ nhanvien.chucvu }}" placeholder="Chức vụ" class="p-2 border rounded" required>
              <input type="text" name="diachi" value="{{ nhanvien.diachi }}" placeholder="Địa chỉ" class="p-2 border rounded" required>
              <input type="text" name="sodienthoai" value="{{ nhanvien.sodienthoai }}" placeholder="Số điện thoại" class="p-2 border rounded" required>
              <input type="date" name="ngaysinh" value="{{ nhanvien.ngaysinh|date:'Y-m-d' }}" class="p-2 border rounded" required>
              <input type="email" name="email" value="{{ nhanvien.email }}" placeholder="Email" class="p-2 border rounded" required>
              <input type="text" name="matkhau" value="{{ nhanvien.matkhau }}" placeholder="Mật khẩu" class="p-2 border rounded" required>

              <div>
                <label class="block mb-1 text-sm font-semibold">Phân quyền</label>
                <select name="phanquyen" class="w-full p-2 border rounded" required>
                  <option {% if nhanvien.phanquyen == 'Quản lý Nhân Viên' %}selected{% endif %}>Quản lý Nhân Viên</option>
                  <option {% if nhanvien.phanquyen == 'Quản lý bãi xe' %}selected{% endif %}>Quản lý bãi xe</option>
                  <option {% if nhanvien.phanquyen == 'Nhân viên thống Kê báo cáo' %}selected{% endif %}>Thống kê & báo cáo</option>
                  <option {% if nhanvien.phanquyen == 'Nhân viên xe ra vào' %}selected{% endif %}>Xe ra vào</option>
                </select>
              </div>

              <div class="flex items-end">
                <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Cập nhật</button>
              </div>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="10" class="p-4 text-center text-gray-500">Không có nhân viên nào.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Add Employee Form -->
  <div id="add_employee_form" class="hidden mt-8 bg-white p-6 rounded-lg shadow-md">
    <h3 class="text-2xl font-bold mb-4">Thêm Nhân Viên</h3>
    <form method="POST" action="{% url 'add_employee' %}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% csrf_token %}
      <input type="text" name="nhanvienid" placeholder="Mã nhân viên" class="p-3 border rounded" required>
      <input type="text" name="hoten" placeholder="Tên nhân viên" class="p-3 border rounded" required>
      <select name="chucvu" class="p-3 border rounded" required>
        <option value="Quản lý">Quản lý</option>
        <option value="Nhân viên">Nhân viên</option>
      </select>
      <input type="text" name="diachi" placeholder="Địa chỉ" class="p-3 border rounded" required>
      <input type="text" name="sodienthoai" placeholder="Số điện thoại" class="p-3 border rounded" required>
      <input type="date" name="ngaysinh" class="p-3 border rounded" required>
      <input type="text" name="email " placeholder="Email " class="p-3 border rounded" required>
      <input type="text" name="matkhau" placeholder="Mật Khẩu" class="p-3 border rounded" required>

      <div class="md:col-span-2">
        <label class="block text-sm font-semibold mb-2">Phân quyền</label>
        <div class="space-y-2">
          <label class="flex items-center"><input type="checkbox" name="phanquyen" value="Quản lý Nhân Viên" class="mr-2">Quản lý Nhân Viên</label>
          <label class="flex items-center"><input type="checkbox" name="phanquyen" value="Quản lý bãi xe" class="mr-2">Quản lý bãi xe</label>
          <label class="flex items-center"><input type="checkbox" name="phanquyen" value="Nhân viên thống Kê báo cáo" class="mr-2">Thống kê & báo cáo</label>
          <label class="flex items-center"><input type="checkbox" name="phanquyen" value="Nhân viên xe ra vào" class="mr-2">Xe ra vào</label>
        </div>
      </div>

      <div class="md:col-span-2">
        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded mt-4 hover:bg-green-700">Thêm nhân viên</button>
      </div>
    </form>
  </div>

</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('show_add_employee_form').addEventListener('click', function() {
    document.getElementById('add_employee_form').classList.toggle('hidden');
  });

  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const id = btn.dataset.id;
      const form = document.getElementById(`edit-form-${id}`);
      form.classList.toggle('hidden');
      document.getElementById('add_employee_form').classList.add('hidden');
    });
  });
});
</script>

</body>
</html>
