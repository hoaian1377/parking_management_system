{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tình Trạng Bãi Giữ Xe</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="{% static 'app/css/employee_management.css' %}" rel="stylesheet" />
</head>
<body class="bg-gray-100">

  <!-- Navigation -->
  <nav class="navbar-custom fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white shadow-md">
    <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center py-4">
      <a class="navbar-brand" href="{% url 'home' %}">Quản lý Nhân viên</a>
      <div class="hidden sm:flex sm:items-center sm:space-x-4" id="navbarMenu">
        <a class="nav-link" href="{% url 'vehicle_management' %}">Quản lý xe</a>
        <a class="nav-link" href="{% url 'parking_status' %}">Tình trạng bãi xe</a>
        <a class="nav-link" href="{% url 'vehicle_report' %}">Báo cáo & thống kê</a>
        <div class="auth-buttons">
          <a class="logout" href="{% url 'login' %}">Đăng xuất</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mx-auto mt-8">
    <h2 class="text-3xl font-semibold mb-6">Quản lý nhân viên</h2>

    <!-- Flash messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="message {% if message.tags == 'success' %}message-success{% elif message.tags == 'error' %}message-error{% endif %} p-4 mb-4 rounded">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Search form -->
    <form method="get" action="{% url 'search_employee' %}" class="flex items-center gap-3 mb-6">
        <input type="text" name="nhanvienid" placeholder="Nhập mã nhân viên"
               class="w-full md:w-1/2 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button type="submit"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          Tìm kiếm
        </button>
      </form>

    <!-- Add Employee Button -->
    <a href="#" id="show_add_employee_form" class="px-4 py-2 bg-green-600 text-white rounded-lg mb-6">Thêm Nhân Viên</a>

    <!-- Employee List -->
    <div class="table-container overflow-x-auto">
      <table class="table-auto w-full border-collapse border border-gray-200 shadow-md rounded-lg">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="p-3 text-left">Mã nhân viên</th>
            <th class="p-3 text-left">Tên nhân viên</th>
            <th class="p-3 text-left">Chức vụ</th>
            <th class="p-3 text-left">Địa chỉ</th>
            <th class="p-3 text-left">Số điện thoại</th>
            <th class="p-3 text-left">Ngày sinh</th>
            <th class="p-3 text-left">Phân quyền</th>
            <th class="p-3 text-left">Hành động</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          {% for nhanvien in nhanviens %}
            <tr class="hover:bg-gray-50">
              <td class="p-3">{{ nhanvien.nhanvienid }}</td>
              <td class="p-3">{{ nhanvien.hoten }}</td>
              <td class="p-3">{{ nhanvien.chucvu }}</td>
              <td class="p-3">{{ nhanvien.diachi }}</td>
              <td class="p-3">{{ nhanvien.sodienthoai }}</td>
              <td class="p-3">{{ nhanvien.ngaysinh }}</td>
              <td class="p-3">
                <span class="px-2 py-1 rounded-full text-sm font-medium
                  {% if nhanvien.phanquyen == 'Quản lý' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                  {{ nhanvien.phanquyen }}
                </span>
              </td>
              <td class="p-3 flex items-center gap-2">
                <a href="#" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm" id="show_edit_employee_form_{{ nhanvien.nhanvienid }}">Sửa</a>
                <form action="{% url 'delete_employee' nhanvien.nhanvienid %}" method="POST" onsubmit="return confirm('Bạn có chắc muốn xóa nhân viên này?')">
                  {% csrf_token %}
                  <button type="submit" class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">Xóa</button>
                </form>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" class="p-4 text-center text-gray-500">Không có nhân viên nào</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Add Employee Form -->
    <div id="add_employee_form" class="form-container hidden p-6 bg-white shadow-md rounded-lg mt-6">
      <h3 class="text-xl font-semibold mb-4">Thêm Nhân Viên Mới</h3>
      <form method="POST" action="{% url 'add_employee' %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="nhanvienid" class="block text-sm font-medium text-gray-700">Mã nhân viên</label>
          <input type="text" id="nhanvienid" name="nhanvienid" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>

        <div class="mb-4">
          <label for="hoten" class="block text-sm font-medium text-gray-700">Tên nhân viên</label>
          <input type="text" id="hoten" name="hoten" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>

        <div class="mb-4">
          <label for="chucvu" class="block text-sm font-medium text-gray-700">Chức vụ</label>
          <select id="chucvu" name="chucvu" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="Quản lý">Quản lý</option>
            <option value="Nhân viên">Nhân viên</option>
          </select>
        </div>

        <div class="mb-4">
          <label for="diachi" class="block text-sm font-medium text-gray-700">Địa chỉ</label>
          <input type="text" id="diachi" name="diachi" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>

        <div class="mb-4">
          <label for="sodienthoai" class="block text-sm font-medium text-gray-700">Số điện thoại</label>
          <input type="text" id="sodienthoai" name="sodienthoai" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>

        <div class="mb-4">
          <label for="ngaysinh" class="block text-sm font-medium text-gray-700">Ngày sinh</label>
          <input type="date" id="ngaysinh" name="ngaysinh" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">Phân quyền</label>
          <div>
            <label for="quanlynv" class="form-check-label">
              <input type="checkbox" id="quanlynv" name="phanquyen" value="Quản lý Nhân Viên" class="form-check-input">
              Quản lý Nhân Viên
            </label>
          </div>
          <div>
            <label for="quanlybx" class="form-check-label">
              <input type="checkbox" id="quanlybx" name="phanquyen" value="Quản lý bãi xe" class="form-check-input">
              Quản lý bãi xe
            </label>
          </div>
          <div>
            <label for="thongkebc" class="form-check-label">
              <input type="checkbox" id="thongkebc" name="phanquyen" value="Nhân viên thống Kê báo cáo" class="form-check-input">
              Nhân viên thống Kê báo cáo
            </label>
          </div>
          <div>
            <label for="xeraiva" class="form-check-label">
              <input type="checkbox" id="xeraiva" name="phanquyen" value="Nhân viên xe ra vào" class="form-check-input">
              Nhân viên xe ra vào
            </label>
          </div>
        </div>

        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg">Thêm Nhân Viên</button>
      </form>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Show the add employee form
      document.getElementById('show_add_employee_form').addEventListener('click', function (e) {
        e.preventDefault();
        document.getElementById('add_employee_form').classList.toggle('hidden');
      });

      // Show the edit employee form
      {% for nhanvien in nhanviens %}
        document.getElementById('show_edit_employee_form_{{ nhanvien.nhanvienid }}').addEventListener('click', function (e) {
          e.preventDefault();
          // Toggle the specific edit form for this employee
          document.getElementById('edit_employee_form_{{ nhanvien.nhanvienid }}').classList.toggle('hidden');
          // Hide the add form when editing
          document.getElementById('add_employee_form').classList.add('hidden');
        });
      {% endfor %}

      // Close forms when clicking outside
      document.addEventListener('click', function(e) {
        const forms = document.querySelectorAll('.form-container');
        const isFormClicked = e.target.closest('.form-container');
        const isButtonClicked = e.target.closest('a');
        // Close forms if click happens outside of form and button
        if (!isFormClicked && !isButtonClicked) {
          forms.forEach(form => form.classList.add('hidden'));
        }
      });
    });
  </script>

</body>
</html>
